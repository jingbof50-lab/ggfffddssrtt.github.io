<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰åˆä¸€äºŒç»´ç å·¥å…·</title>
    <!-- ä½¿ç”¨ qrcode.js ç”ŸæˆäºŒç»´ç  -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <!-- ä½¿ç”¨ html2canvas ä¿å­˜ä¸ºå›¾ç‰‡ -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- å¼•å…¥ jsQR åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary-color: #4a6cf7;
            --primary-dark: #3a5be0;
            --light-bg: #f5f7fa;
            --card-bg: #ffffff;
            --text-dark: #3a4656;
            --text-light: #5a6b82;
            --border-color: #d1d8e0;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        body {
            background: linear-gradient(135deg, #f0f4ff 0%, #e4e8f0 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header {
            background: var(--primary-color);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-weight: 500;
            font-size: 2.2rem;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-weight: 300;
            opacity: 0.9;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* é€‰é¡¹å¡æ ·å¼ */
        .tabs {
            display: flex;
            background: #f0f4ff;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab {
            flex: 1;
            padding: 16px;
            text-align: center;
            background: transparent;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary-color);
            border-radius: 3px 3px 0 0;
        }
        
        .tab:hover:not(.active) {
            background: rgba(74, 108, 247, 0.1);
            color: var(--primary-dark);
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ç”Ÿæˆå™¨æ ·å¼ */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .input-group input[type="text"],
        .input-group input[type="color"],
        .input-group input[type="file"],
        .input-group input[type="range"] {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: #f9fbfd;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.2);
        }
        
        .color-picker {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .size-control {
            margin-bottom: 20px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin: 25px 0;
        }
        
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 108, 247, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #f9fbfd;
            color: var(--text-light);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: #f0f4ff;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn:disabled {
            background: #d1d8e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        #qrcode {
            margin: 30px 0;
            text-align: center;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preview-container {
            position: relative;
            display: inline-block;
        }
        
        #logo-preview {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 20%;
            pointer-events: none;
        }
        
        /* å›¾ç‰‡æ‰«ææ ·å¼ */
        .upload-section {
            width: 100%;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: #f9fbfd;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            position: relative;
        }
        
        .upload-section:hover {
            border-color: var(--primary-color);
            background: #f0f4ff;
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .upload-text {
            color: var(--text-light);
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .file-input {
            display: none;
        }
        
        .preview-section {
            width: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .preview-title {
            color: var(--text-light);
            margin-bottom: 15px;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .preview-img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }
        
        .result-section {
            width: 100%;
            background: #f9fbfd;
            border-radius: 12px;
            padding: 25px;
            display: none;
            border-left: 4px solid var(--primary-color);
        }
        
        .result-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-content {
            background: white;
            padding: 18px;
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-dark);
            word-break: break-all;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
        }
        
        .action-btns {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* æ‘„åƒå¤´æ‰«ææ ·å¼ */
        #camera-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 20px 0;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
            box-shadow: var(--shadow);
        }
        
        #camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .scan-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border: 3px solid var(--primary-color);
            border-radius: 12px;
            box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-color);
            animation: scan 2s infinite linear;
        }
        
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        .camera-result {
            margin: 25px 0;
            padding: 20px;
            background: #f9fbfd;
            border-radius: 12px;
            border-left: 4px solid var(--primary-color);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--text-light);
        }
        
        .spinner {
            border: 4px solid rgba(74, 108, 247, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.9rem;
            border-top: 1px solid #eef2f7;
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 12px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .color-picker {
                flex-direction: column;
                gap: 10px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            #camera-container {
                height: 300px;
            }
            
            .scan-frame {
                width: 200px;
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ä¸‰åˆä¸€äºŒç»´ç å·¥å…·</h1>
            <div class="subtitle">ç”Ÿæˆã€æ‰«æã€è¯†åˆ« - ä¸€ç«™å¼äºŒç»´ç è§£å†³æ–¹æ¡ˆ</div>
        </header>
        
        <div class="tabs">
            <button class="tab active" data-tab="generate">ç”ŸæˆäºŒç»´ç </button>
            <button class="tab" data-tab="scan-image">æ‰«æå›¾ç‰‡</button>
            <button class="tab" data-tab="scan-camera">æ‘„åƒå¤´æ‰«æ</button>
        </div>
        
        <!-- ç”ŸæˆäºŒç»´ç  -->
        <div id="generate" class="tab-content active">
            <div class="input-group">
                <label for="qr-content">è¾“å…¥å†…å®¹ï¼ˆURL/æ–‡å­—ï¼‰:</label>
                <input type="text" id="qr-content" placeholder="https://example.com">
            </div>

            <div class="color-picker">
                <div class="input-group">
                    <label>å‰æ™¯è‰²:</label>
                    <input type="color" id="fg-color" value="#000000">
                </div>
                <div class="input-group">
                    <label>èƒŒæ™¯è‰²:</label>
                    <input type="color" id="bg-color" value="#ffffff">
                </div>
            </div>

            <div class="size-control input-group">
                <label>å°ºå¯¸: <span id="size-value">200</span>px</label>
                <input type="range" id="qr-size" min="100" max="500" value="200">
            </div>

            <div class="input-group">
                <label>æ·»åŠ  Logo (é€‰å¡«):</label>
                <input type="file" id="logo-upload" accept="image/*">
                <div id="logo-preview-container"></div>
            </div>

            <div class="button-group">
                <button class="btn" onclick="generateQR()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    ç”ŸæˆäºŒç»´ç 
                </button>
                <button class="btn btn-secondary" onclick="downloadQR()" id="download-btn" disabled>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    ä¸‹è½½å›¾ç‰‡
                </button>
            </div>

            <div id="qrcode"></div>
        </div>
        
        <!-- æ‰«æå›¾ç‰‡ -->
        <div id="scan-image" class="tab-content">
            <div class="upload-section" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">æ‹–æ”¾å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»æŒ‰é’®ä¸Šä¼ </div>
                <button class="btn" id="uploadBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M17 8L12 3L7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 3V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    é€‰æ‹©å›¾ç‰‡
                </button>
                <input type="file" id="fileInput" class="file-input" accept="image/*">
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨è§£æäºŒç»´ç ...</p>
            </div>
            
            <div class="preview-section" id="previewSection">
                <div class="preview-title">å›¾ç‰‡é¢„è§ˆ</div>
                <img id="previewImg" class="preview-img" alt="é¢„è§ˆå›¾">
                <div class="action-btns">
                    <button class="btn" id="scanBtn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 9H4V15H2V9ZM6 9H8V15H6V9ZM10 9H12V15H10V9ZM14 9H16V15H14V9ZM18 9H20V15H18V9ZM22 9H24V15H22V9ZM0 17H24V19H0V17ZM0 5H24V7H0V5Z" fill="currentColor"/>
                        </svg>
                        æ‰«æäºŒç»´ç 
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.5 2V8H8.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C10.2977 2 8.69594 2.39573 7.28571 3.09479" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        é‡æ–°ä¸Šä¼ 
                    </button>
                </div>
            </div>
            
            <div class="result-section" id="resultSection">
                <div class="result-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#4a6cf7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    äºŒç»´ç å†…å®¹
                </div>
                <div class="result-content" id="resultContent"></div>
            </div>
        </div>
        
        <!-- æ‘„åƒå¤´æ‰«æ -->
        <div id="scan-camera" class="tab-content">
            <div class="input-group">
                <label>å°†äºŒç»´ç ç½®äºæ¡†å†…è¿›è¡Œæ‰«æ</label>
            </div>
            
            <div id="camera-container">
                <video id="camera-view" playsinline></video>
                <div class="scan-frame">
                    <div class="scan-line"></div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn" id="toggleCameraBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M23 19C23 19.5304 22.7893 20.0391 22.4142 20.4142C22.0391 20.7893 21.5304 21 21 21H3C2.46957 21 1.96086 20.7893 1.58579 20.4142C1.21071 20.0391 1 19.5304 1 19V8C1 7.46957 1.21071 6.96086 1.58579 6.58579C1.96086 6.21071 2.46957 6 3 6H7L9 3H15L17 6H21C21.5304 6 22.0391 6.21071 22.4142 6.58579C22.7893 6.96086 23 7.46957 23 8V19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 17C14.2091 17 16 15.2091 16 13C16 10.7909 14.2091 9 12 9C9.79086 9 8 10.7909 8 13C8 15.2091 9.79086 17 12 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    å¼€å¯æ‘„åƒå¤´
                </button>
            </div>
            
            <div class="camera-result">
                <div class="result-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    æ‰«æç»“æœ
                </div>
                <div class="result-content" id="cameraResult">ç­‰å¾…æ‰«æ...</div>
            </div>
        </div>
        
        <div class="footer">
            <p>ä½¿ç”¨ qrcode.js å’Œ jsQR æ„å»º | ä¸‰åˆä¸€äºŒç»´ç å·¥å…·</p>
        </div>
    </div>

    <script>
        // é€‰é¡¹å¡åŠŸèƒ½
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // åˆ‡æ¢åˆ°æ‘„åƒå¤´æ ‡ç­¾æ—¶å…³é—­ä¹‹å‰çš„æ‘„åƒå¤´
                if (tabId !== 'scan-camera' && cameraStream) {
                    stopCamera();
                }
                
                // åˆ‡æ¢åˆ°æ‘„åƒå¤´æ ‡ç­¾æ—¶åˆå§‹åŒ–
                if (tabId === 'scan-camera') {
                    initCameraTab();
                }
            });
        });
        
        // ç”ŸæˆäºŒç»´ç åŠŸèƒ½
        let qr = null;
        let logoImage = null;

        function generateQR() {
            const content = document.getElementById('qr-content').value;
            if (!content) {
                alert('è¯·è¾“å…¥å†…å®¹ï¼');
                return;
            }

            // æ¸…é™¤æ—§çš„äºŒç»´ç 
            const qrcodeDiv = document.getElementById('qrcode');
            qrcodeDiv.innerHTML = '';

            // è·å–è®¾å®šå€¼
            const fgColor = document.getElementById('fg-color').value;
            const bgColor = document.getElementById('bg-color').value;
            const size = document.getElementById('qr-size').value;

            // ç”Ÿæˆæ–°äºŒç»´ç 
            qr = new QRCode(qrcodeDiv, {
                text: content,
                width: size,
                height: size,
                colorDark: fgColor,
                colorLight: bgColor,
                correctLevel: QRCode.CorrectLevel.H
            });

            // å¯ç”¨ä¸‹è½½æŒ‰é’®
            document.getElementById('download-btn').disabled = false;

            // æ·»åŠ  Logoï¼ˆå¦‚æœæœ‰ï¼‰
            setTimeout(addLogoToQR, 100);
        }

        function addLogoToQR() {
            if (!logoImage) return;

            const qrImg = document.querySelector('#qrcode img');
            const container = document.createElement('div');
            container.className = 'preview-container';
            
            container.innerHTML = `
                <img src="${qrImg.src}" style="width: 100%">
                <img id="logo-preview" src="${logoImage}">
            `;

            document.getElementById('qrcode').innerHTML = '';
            document.getElementById('qrcode').appendChild(container);
        }

        // Logo ä¸Šä¼ å¤„ç†
        document.getElementById('logo-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoImage = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // å°ºå¯¸æ§åˆ¶
        document.getElementById('qr-size').addEventListener('input', function(e) {
            document.getElementById('size-value').textContent = e.target.value;
        });

        // ä¸‹è½½å›¾ç‰‡
        async function downloadQR() {
            const container = document.querySelector('#qrcode .preview-container') || document.querySelector('#qrcode');
            
            html2canvas(container).then(canvas => {
                const link = document.createElement('a');
                link.download = 'qrcode.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
        
        // å›¾ç‰‡æ‰«æåŠŸèƒ½
        const uploadArea = document.getElementById('uploadArea');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const previewSection = document.getElementById('previewSection');
        const previewImg = document.getElementById('previewImg');
        const scanBtn = document.getElementById('scanBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultSection = document.getElementById('resultSection');
        const resultContent = document.getElementById('resultContent');
        const loading = document.getElementById('loading');
        
        // ç‚¹å‡»ä¸Šä¼ æŒ‰é’®è§¦å‘æ–‡ä»¶é€‰æ‹©
        uploadBtn.addEventListener('click', () => {
            fileInput.click();
        });
        
        // æ–‡ä»¶é€‰æ‹©å˜åŒ–
        fileInput.addEventListener('change', function(e) {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    uploadArea.style.display = 'none';
                    previewSection.style.display = 'flex';
                    resultSection.style.display = 'none';
                }
                
                reader.readAsDataURL(file);
            }
        });
        
        // æ‹–æ”¾åŠŸèƒ½
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary-color)';
            uploadArea.style.background = '#f0f4ff';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = 'var(--border-color)';
            uploadArea.style.background = '#f9fbfd';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--border-color)';
            uploadArea.style.background = '#f9fbfd';
            
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                const file = e.dataTransfer.files[0];
                
                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                if (!file.type.match('image.*')) {
                    alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    uploadArea.style.display = 'none';
                    previewSection.style.display = 'flex';
                    resultSection.style.display = 'none';
                }
                
                reader.readAsDataURL(file);
            }
        });
        
        // æ‰«ææŒ‰é’®ç‚¹å‡»äº‹ä»¶
        scanBtn.addEventListener('click', () => {
            loading.style.display = 'block';
            previewSection.style.display = 'none';
            
            setTimeout(() => {
                scanQRCode(previewImg);
            }, 500);
        });
        
        // é‡ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        resetBtn.addEventListener('click', () => {
            fileInput.value = '';
            previewSection.style.display = 'none';
            resultSection.style.display = 'none';
            uploadArea.style.display = 'block';
        });
        
        // äºŒç»´ç æ‰«æå‡½æ•°
        function scanQRCode(imgElement) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = imgElement.width;
            canvas.height = imgElement.height;
            
            ctx.drawImage(imgElement, 0, 0, canvas.width, canvas.height);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height, {
                inversionAttempts: "dontInvert",
            });
            
            loading.style.display = 'none';
            
            if (code) {
                resultContent.textContent = code.data;
                resultSection.style.display = 'block';
                previewSection.style.display = 'flex';
            } else {
                alert('æœªæ£€æµ‹åˆ°äºŒç»´ç ï¼Œè¯·å°è¯•å…¶ä»–å›¾ç‰‡');
                previewSection.style.display = 'flex';
            }
        }
        
        // æ‘„åƒå¤´æ‰«æåŠŸèƒ½
        let cameraStream = null;
        let scanning = false;
        const cameraView = document.getElementById('camera-view');
        const cameraResult = document.getElementById('cameraResult');
        const toggleCameraBtn = document.getElementById('toggleCameraBtn');
        
        // åˆå§‹åŒ–æ‘„åƒå¤´æ ‡ç­¾
        function initCameraTab() {
            if (!cameraStream) {
                toggleCameraBtn.textContent = "å¼€å¯æ‘„åƒå¤´";
            }
        }
        
        // åˆ‡æ¢æ‘„åƒå¤´å¼€å…³
        toggleCameraBtn.addEventListener('click', toggleCamera);
        
        async function toggleCamera() {
            if (scanning) {
                stopCamera();
                toggleCameraBtn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M23 19C23 19.5304 22.7893 20.0391 22.4142 20.4142C22.0391 20.7893 21.5304 21 21 21H3C2.46957 21 1.96086 20.7893 1.58579 20.4142C1.21071 20.0391 1 19.5304 1 19V8C1 7.46957 1.21071 6.96086 1.58579 6.58579C1.96086 6.21071 2.46957 6 3 6H7L9 3H15L17 6H21C21.5304 6 22.0391 6.21071 22.4142 6.58579C22.7893 6.96086 23 7.46957 23 8V19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 17C14.2091 17 16 15.2091 16 13C16 10.7909 14.2091 9 12 9C9.79086 9 8 10.7909 8 13C8 15.2091 9.79086 17 12 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    å¼€å¯æ‘„åƒå¤´
                `;
            } else {
                await startCamera();
                toggleCameraBtn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M9 3H15L17 6H21C21.5304 6 22.0391 6.21071 22.4142 6.58579C22.7893 6.96086 23 7.46957 23 8V19C23 19.5304 22.7893 20.0391 22.4142 20.4142C22.0391 20.7893 21.5304 21 21 21H3C2.46957 21 1.96086 20.7893 1.58579 20.4142C1.21071 20.0391 1 19.5304 1 19V8C1 7.46957 1.21071 6.96086 1.58579 6.58579C1.96086 6.21071 2.46957 6 3 6H7L9 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 17C13.6569 17 15 15.6569 15 14C15 12.3431 13.6569 11 12 11C10.3431 11 9 12.3431 9 14C9 15.6569 10.3431 17 12 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    å…³é—­æ‘„åƒå¤´
                `;
            }
        }
        
        // å¯åŠ¨æ‘„åƒå¤´
        async function startCamera() {
            try {
                cameraResult.textContent = "æ‰«æä¸­...";
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "environment" }
                });
                cameraView.srcObject = cameraStream;
                await cameraView.play();
                scanning = true;
                scanWithCamera();
            } catch (error) {
                alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·ç¡®ä¿å·²æˆäºˆæƒé™ã€‚");
                cameraResult.textContent = "æ‘„åƒå¤´è®¿é—®å¤±è´¥";
            }
        }
        
        // å…³é—­æ‘„åƒå¤´
        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            scanning = false;
            cameraView.srcObject = null;
            cameraResult.textContent = "æ‘„åƒå¤´å·²å…³é—­";
        }
        
        // æ‰«ç é€»è¾‘
        function scanWithCamera() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            const scanFrame = document.querySelector('.scan-frame');
            const frameRect = scanFrame.getBoundingClientRect();

            function tick() {
                if (cameraView.readyState === cameraView.HAVE_ENOUGH_DATA && scanning) {
                    canvas.width = cameraView.videoWidth;
                    canvas.height = cameraView.videoHeight;
                    
                    // åªæ‰«ææ¡†å†…åŒºåŸŸ
                    const frameWidth = frameRect.width * (canvas.width / cameraView.clientWidth);
                    const frameHeight = frameRect.height * (canvas.height / cameraView.clientHeight);
                    const frameX = (canvas.width - frameWidth) / 2;
                    const frameY = (canvas.height - frameHeight) / 2;
                    
                    context.drawImage(cameraView, 0, 0, canvas.width, canvas.height);
                    const imageData = context.getImageData(frameX, frameY, frameWidth, frameHeight);
                    
                    const code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: "dontInvert",
                    });

                    if (code) {
                        cameraResult.innerHTML = `æ‰«ææˆåŠŸï¼å†…å®¹ï¼š<strong>${code.data}</strong>`;
                    }
                }
                requestAnimationFrame(tick);
            }
            tick();
        }
        
        // åˆå§‹åŒ–é¡µé¢
        window.addEventListener('load', () => {
            // è®¾ç½®åˆå§‹å€¼
            document.getElementById('size-value').textContent = 
                document.getElementById('qr-size').value;
            
            // ç”Ÿæˆé»˜è®¤äºŒç»´ç 
            document.getElementById('qr-content').value = 'https://github.com';
            setTimeout(generateQR, 500);
        });
    </script>
</body>
</html>